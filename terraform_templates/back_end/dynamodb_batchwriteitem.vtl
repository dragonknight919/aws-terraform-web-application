{
  "RequestItems": {
    ## Templated by Terraform
    "${dynamodb_table_name}": [
    #set( $nameList = $input.path('$.name').split('\n') )
    #if( $nameList.size() == 1 )
      {
        "PutRequest": {
          "Item": {
            "check": {
              "BOOL": "$input.path('$.check')"
            },
            "id": {
              "S": "$context.requestId"
            },
            "modified": {
              "N": "$context.requestTimeEpoch"
            },
            "name": {
              "S": "$nameList[0]"
            },
            "priority": {
              "N": "$input.path('$.priority')"
            },
            "timestamp": {
              "N": "$context.requestTimeEpoch"
            }
          }
        }
      }
    #else
    #foreach( $name in $nameList )
      {
        "PutRequest": {
          "Item": {
            "check": {
              "BOOL": "$input.path('$.check')"
            },
            "id": {
              ## Escape Terraform templating
              "S": "$${context.requestId}-$foreach.count"
            },
            "modified": {
              "N": "$context.requestTimeEpoch"
            },
            "name": {
              "S": "$name"
            },
            "priority": {
              "N": "$input.path('$.priority')"
            },
            "timestamp": {
              "N": "$context.requestTimeEpoch"
            }
          }
        }
      }#if($foreach.hasNext),#end
    #end
    #end
    ]
  }
}
